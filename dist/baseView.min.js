!function(e,n,s,i){"use strict";e.wk=e.wk||{};var o=e.wk.getTemplate,r=e.wk.repo&&e.wk.repo.require,a=0,t=i.app&&i.app.$document||e(document),h=i.app&&i.app.$window||e(i);e.wk.baseView=n.View.extend({constructor:function(){this.subviews={},this.modelSubviews={},n.View.apply(this,arguments)},close:function(e){this.beforeClose&&this.beforeClose(),e&&!e.parentClosing&&this.trigger("manualClosing"),this.closeSubviews(),this.ens&&(t.off(this.ens),h.off(this.ens)),this.onDocCancel.registry&&s.each(this.onDocCancel.registry,function(i,e){i&&(t.off(e),delete this.onDocCancel.registry[e])},this),this.deferreds&&s.each(this.deferreds,function(e){"pending"===e.state()&&(e.abort?e.abort():e.reject())}),this.remove(),this.closed=!0,this.afterClose&&this.afterClose()},closeSubviews:function(e){this.hasSubviews()&&(e?(s.invoke(this["subviews-"+e],"close"),delete this["subviews-"+e]):(s.each(this.subviews,function(e){e.close({parentClosing:!0})}),this.subviews={},this.modelSubviews={}))},addSubview:function(e,i){return this.subviews[e.cid]=e,e.model&&(this.modelSubviews[e.model.cid]=e),i&&(this["subviews-"+i]=this["subviews-"+i]||{},this["subviews-"+i][e.cid]=e),e.on("manualClosing",s.bind(function(){delete this.subviews[e.cid],e.model&&delete this.modelSubviews[e.model.cid],i&&delete this["subviews-"+i][e.cid]},this)),e},closeSubview:function(i){var e=this.modelSubviews[i.cid];return e?void e.close():!1},getSubview:function(e){return this.modelSubviews[e.cid]?this.modelSubviews[e.cid]:!1},hasSubviews:function(){return s.size(this.subviews)>0?!0:!1},publishEvent:function(e,i){t.trigger(e,[i])},subscribeToEvent:function(e,i){this.setupEventNamespace(),t.on(e+this.ens,s.bind(i,this))},loadingOn:function(){this.$loadingHtml=this.$loadingHtml||e('<div class="loader"><span class="graphics">Loading</span></div>').appendTo(this.$el),this.$loading_html.addClass("on")},loadingOff:function(){this.$loadingHtml&&this.$loadingHtml.removeClass("on")},onDocCancel:function(o,n,r,a){this.onDocCancel.registry=this.onDocCancel.registry||{},this.setupEventNamespace();var i=this.ens+o,s=this.onDocCancel.registry,h=r||this.$el;return"off"===n?(t.off(i),void(s[i]=!1)):s[i]?void 0:(t.on("click"+i+" keyup"+i,function(o){if(27===o.keyCode)n();else{var r=e(o.target);r.parents().is(h)||n()}a&&(t.off(i),s[i]=!1)}),s[i]=!0,this)},setupEventNamespace:function(){return this.ens=this.ens||".view"+ ++a,this},getTemplate:function(t,n,e){var i=this;this.templates=this.templates||{};var s=o(n,function(s){i.templates[t]=s,e&&e.call(i,s)});return this.deferreds=this.deferreds||[],this.deferreds.push(s),s},require:function(s,t,e){e||(e=this);var i=r(s,t,e);return this.deferreds=this.deferreds||[],this.deferreds.push(i),i},whenDone:function(a,n,o,s){var r=this,t=e.Deferred();return e.when.apply(i,a).done(function(){s||(s=r),n&&n.call(s),t.resolve()}).fail(function(){s||(s=r),o&&o.call(s),t.reject()}),t}}),i.app&&"undefined"==typeof i.app.baseView&&(i.app.baseView=e.wk.baseView)}(window.jQuery,window.Backbone,window._,window);