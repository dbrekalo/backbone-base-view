!function(e,n,t,i){"use strict";e.wk=e.wk||{};var o=e.wk.getTemplate,r=e.wk.repo&&e.wk.repo.require,a=0,s=i.app&&i.app.$document||e(document),c=i.app&&i.app.$window||e(i);e.wk.baseView=n.View.extend({constructor:function(){this.subviews={},this.modelSubviews={},n.View.apply(this,arguments)},close:function(e){this.beforeClose&&this.beforeClose(),e||this.trigger("manualClosing"),this.closeSubviews(),this.ens&&(s.off(this.ens),c.off(this.ens)),this.onDocCancel.registry&&t.each(this.onDocCancel.registry,function(i,e){i&&(s.off(e),delete this.onDocCancel.registry[e])},this),this.deferreds&&t.each(this.deferreds,function(e){"pending"===e.state()&&e.reject()}),this.remove(),this.closed=!0,this.afterClose&&this.afterClose()},closeSubviews:function(){this.hasSubviews()&&(t.each(this.subviews,function(e){e.close("parentInitiated")}),this.subviews={},this.modelSubviews={})},addSubview:function(e){var i=this;return this.subviews[e.cid]=e,e.model&&(this.modelSubviews[e.model.cid]=e),e.on("manualClosing",function(){delete i.subviews[e.cid],e.model&&delete i.modelSubviews[e.model.cid]}),e},closeSubview:function(i){var e=this.modelSubviews[i.cid];return e?void e.close():!1},getSubview:function(e){return this.modelSubviews[e.cid]?this.modelSubviews[e.cid]:!1},hasSubviews:function(){return t.size(this.subviews)>0?!0:!1},publishEvent:function(e,i){s.trigger(e,[i])},subscribeToEvent:function(i,t){this.setupEventNamespace(),s.on(i+this.ens,e.proxy(t,this))},loadingOn:function(){this.$loadingHtml=this.$loadingHtml||e('<div class="loader"><span class="graphics">Loading</span></div>').appendTo(this.$el),this.$loading_html.addClass("on")},loadingOff:function(){this.$loadingHtml&&this.$loadingHtml.removeClass("on")},onDocCancel:function(o,n,r,a){this.onDocCancel.registry=this.onDocCancel.registry||{},this.setupEventNamespace();var i=this.ens+o,t=this.onDocCancel.registry,c=r||this.$el;return"off"===n?(s.off(i),void(t[i]=!1)):t[i]?void 0:(s.on("click"+i+" keyup"+i,function(o){if(o.keyCode&&27===o.keyCode)n();else{var r=e(o.target);r.parents().is(c)||n()}a&&(s.off(i),t[i]=!1)}),t[i]=!0,this)},setupEventNamespace:function(){return this.ens=this.ens||".view"+ ++a,this},getTemplate:function(t,n,e){var i=this;this.templates=this.templates||{};var s=o(n,function(s){i.templates[t]=s,e&&e.call(i,s)});return this.deferreds=this.deferreds||[],this.deferreds.push(s),s},require:function(s,t,e){e||(e=this);var i=r(s,t,e);return this.deferreds=this.deferreds||[],this.deferreds.push(i),i},whenDone:function(a,n,o,s){var r=this,t=e.Deferred();return e.when.apply(i,a).done(function(){s||(s=r),n&&n.call(s),t.resolve()}).fail(function(){s||(s=r),o&&o.call(s),t.reject()}),t}}),i.app&&"undefined"==typeof i.app.baseView&&(i.app.baseView=e.wk.baseView)}(window.jQuery,window.Backbone,window._,window);