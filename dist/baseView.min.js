!function(e,n,s,i){"use strict";e.wk=e.wk||{};var o=e.wk.getTemplate,r=e.wk.repo&&e.wk.repo.require,a=0,t=i.app&&i.app.$document||e(document),h=i.app&&i.app.$window||e(i);e.wk.baseView=n.View.extend({constructor:function(){this.subviews={},this.noModelViewCounter=0,n.View.apply(this,arguments)},close:function(e){e||this.trigger("manualClosing"),this.hasSubviews()&&s.each(this.subviews,function(e){e.close("parentInitiated")}),this.ens&&(t.off(this.ens),h.off(this.ens)),this.onDocCancel.registry&&s.each(this.onDocCancel.registry,function(i,e){i&&(t.off(e),delete this.onDocCancel.registry[e])},this),this.deferreds&&s.each(this.deferreds,function(e){"pending"===e.state()&&e.reject()}),this.beforeClose&&this.beforeClose(),this.remove()},closeSubviews:function(){this.hasSubviews()&&(s.each(this.subviews,function(e){e.close("parentInitiated")}),this.subviews={})},addSubview:function(e){var i=this;return e.model?this.subviews[e.model.cid]=e:this.subviews["noModelView"+ ++this.noModelViewCounter]=e,e.on("manualClosing",function(){delete i.subviews[e.model.cid]}),e},removeSubview:function(e){return this.subviews[e.cid]?(this.subviews[e.cid].close("parentInitiated"),void delete this.subviews[e.cid]):!1},getSubview:function(e){return this.subviews[e.cid]?this.subviews[e.cid]:!1},hasSubviews:function(){return s.size(this.subviews)>0?!0:!1},loadingOn:function(){this.$loadingHtml=this.$loadingHtml||e('<div class="loader"><span class="graphics">Loading</span></div>').appendTo(this.$el),this.$loading_html.addClass("on")},loadingOff:function(){this.$loadingHtml&&this.$loadingHtml.removeClass("on")},onDocCancel:function(o,n,r,a){this.onDocCancel.registry=this.onDocCancel.registry||{},this.setupEventNamespace();var i=this.ens+o,s=this.onDocCancel.registry,h=r||this.$el;return"off"===n?(t.off(i),void(s[i]=!1)):s[i]?void 0:(t.on("click"+i+" keyup"+i,function(o){if(o.keyCode&&27===o.keyCode)n();else{var r=e(o.target);r.parents().is(h)||n()}a&&(t.off(i),s[i]=!1)}),s[i]=!0,this)},setupEventNamespace:function(){return this.ens=this.ens||".view"+ ++a,this},getTemplate:function(t,n,i){var e,s=this;return this.templates=this.templates||{},e=o(n,function(e){s.templates[t]=e,i&&i.call(s,e)}),this.deferreds=this.deferreds||[],this.deferreds.push(e),e},require:function(i,s,t){var e=r(i,s,t);return this.deferreds=this.deferreds||[],this.deferreds.push(e),e}}),i.app&&void 0===i.app.baseView&&(i.app.baseView=e.wk.baseView)}(window.jQuery,window.Backbone,window._,window);